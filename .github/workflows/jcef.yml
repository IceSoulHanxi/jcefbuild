name: Publish Latest Releases

on:
  release:
    types: [edited]
  schedule:
#     - cron: '0 12 */2 * *' # Every other day at 12pm
    - cron: '5 * * * *'      # Every 5 minutes (for testing)

jobs:
  check-jcef-new-release:
    env:
      DYNAMIC_ENV_FILE: ${{ join(env.GITHUB_WORKSPACE, '__ENVIRONEMENTS') }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: Checkout JCEF
        run: |
          pwd
          echo $GITHUB_WORKSPACE
          git clone https://github.com/chromiumembedded/java-cef jcef

      - name: Latest Published Release and Latest CEF Release
        shell: bash
        run: |
          pwd
          echo $GITHUB_WORKSPACE
          ls -l $GITHUB_WORKSPACE
          echo "::set-env name=LATEST_BUILD_VERSION::$(git describe --tags --abbrev=0 | egrep -io '([0-9]+\.?){3}\+g\w+\+chromium-([0-9]+\.?){4}')"
          echo "::set-env name=LATEST_CEF_VERSION::$(./make-release-version.sh $GITHUB_WORKSPACE/jcef)"
          cat <<EOF
            export LATEST_BUILD_VERSION::$(git describe --tags --abbrev=0 | egrep -io '([0-9]+\.?){3}\+g\w+\+chromium-([0-9]+\.?){4}')
            export LATEST_CEF_VERSION="$(./make-release-version.sh $GITHUB_WORKSPACE/jcef)"
          EOF >> $DYNAMIC_ENV_FILE
          
      - name: Compare versions
        shell: bash
        run: |
          pwd
          cat $DYNAMIC_ENV_FILE
          echo $GITHUB_WORKSPACE
          echo $LATEST_BUILD_VERSION
          echo $LATEST_CEF_VERSION
